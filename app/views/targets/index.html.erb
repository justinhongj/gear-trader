<h1> <%= current_user.username %> </h1>

<p>Location: <%= current_user.state %>, <%= current_user.city %> </p>
<p>Trade Rating: <%= current_user.rating %> </p>


<div>
	<h2>My Posts</h2>
	<% @posts.where(status: 'Available').each do |post| %>
			<div class="post-summary">
				<h3><%= link_to post.title, post_path(post) %> | <%= post.status %></h3>
				<p> <%= link_to "Edit", edit_post_path(post) %> | <%= link_to "Delete", post_path(post), method: :delete, data: {confirm: "Are you sure you want to delete this post?"} %> </p>
				<p><strong>Description:</strong></p>
				<p> <%= post.description %> </p>
				<p><strong>Looking For:</strong></p>
				<p> <%= post.wanted %> </p>
				<p> <%= post.created_at %></p>
			</div>
			<div class="trade-offers">
				<h4>Trade Offers</h4>
				<% Trade.where(post_id: post.id).each do |trade| %>
					<% user = User.find_by(id: trade.user_id) %>
					<div>
						<p> <%= link_to user.username, user_path(id: trade.user_id) %> | Trade Rating: <%= user.rating %> <%= button_to "Send Message", {:controller => 'chats', :action => 'create', :user_id => user.id}, :method => :post %></p>
						<p> <%= trade.description %> </p>
						<p> <%= trade.condition %> </p>
					</div>
				<% end %>
			</div>
	<% end %>
	<% @posts.where(status: 'Closed').each do |post| %>
			<div class="post-summary">
				<h3><%= link_to post.title, post_path(post) %> | <%= post.status %></h3>
				<p> <%= link_to "Edit", edit_post_path(post) %> | <%= link_to "Delete", post_path(post), method: :delete, data: {confirm: "Are you sure you want to delete this post?"} %> </p>
				<p><strong>Description:</strong></p>
				<p> <%= post.description %> </p>
				<p><strong>Looking For:</strong></p>
				<p> <%= post.wanted %> </p>
				<p> <%= post.created_at %></p>
			</div>
			<div class="trade-offers">
				<h4>Trade Offers</h4>
				<% Trade.where(post_id: post.id).each do |trade| %>
					<% user = User.find_by(id: trade.user_id) %>
					<div>
						<p> <%= link_to user.username, user_path(id: trade.user_id) %> | Trade Rating: <%= user.rating %> <%= button_to "Send Message", {:controller => 'chats', :action => 'create', :user_id => user.id}, :method => :post %> </p>
						<p> <%= trade.description %> </p>
						<p> <%= trade.condition %> </p>
					</div>
				<% end %>
			</div>
	<% end %>
</div>

<div>
	<h2>Watching</h2>
	<% @watches.each do |watch| %>
		<% post = Post.find_by(id: watch.post_id) %>
		<% user = User.find_by(id: post.user_id) %>
		<div class="post-summary">
			<h3> <%= link_to post.title, post_path(post) %> | <%= post.status %> </h3>
			<p> <%= link_to user.username, user_path(user) %> | Trade Rating: <%= user.rating %> <%= button_to "Send Message", {:controller => 'chats', :action => 'create', :user_id => user.id}, :method => :post %> </p>
			<p><strong>Description:</strong></p>
			<p> <%= post.description %> </p>
			<p><strong>Looking For:</strong></p>
			<p> <%= post.wanted %> </p>
			<p> <%= post.created_at %> </p>
			<p> <%= link_to "Unwatch", delete_watch_path(watch) ,method: :delete ,data: {confirm: "Are you sure you want to unwatch this post?"} %> </p>
		</div>
		<% if Trade.find_by(post_id: post.id, user_id: current_user.id) %>
			<div class="trade-offers">
				<h4>My Trade Offer</h4>
				<% trade = Trade.find_by(post_id: post.id, user_id: current_user.id) %>
				<p> <%= trade.description %> </p>
				<p> <%= trade.condition %> </p>

			</div>
		<% end %>	
	<% end %>
</div>

<div>
	<h2>My Trade Offers</h2>
	<% @trades.each do |trade| %>
		<% post = Post.find_by(id: trade.post_id) %>
		<% user = User.find_by(id: post.user_id) %>
		<div class="post-summary">
			<h3> <%= link_to post.title, post_path(post) %> | <%= post.status %> </h3>
			<p> <%= link_to user.username, user_path(user) %> | Trade Rating: <%= user.rating %> <%= button_to "Send Message", {:controller => 'chats', :action => 'create', :user_id => user.id}, :method => :post %> </p>
			<p><strong>Description:</strong></p>
			<p> <%= post.description %> </p>
			<p><strong>Looking For:</strong></p>
			<p> <%= post.wanted %> </p>
			<p> <%= post.created_at %> </p>
			<h3> My Trade Offer</h3>
			<p> <%= trade.description %> </p>
			<p> <%= trade.condition %> </p>
			<p> <%= link_to "Cancel Trade Offer", delete_trade_path(trade) ,method: :delete ,data: {confirm: "Are you sure you want to cancel this trade offer?"} %> </p>
		</div>
	<% end %>
</div>

